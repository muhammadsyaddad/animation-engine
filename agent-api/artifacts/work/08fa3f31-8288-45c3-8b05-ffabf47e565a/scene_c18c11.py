from manim import *
from math import *
config.frame_size = (1280, 720)
config.frame_width = 10.0

from manim import *
import math

# Embedded histogram data
TIMES = ['1800', '1801', '1802', '1803', '1804', '1805', '1806', '1807', '1808', '1809', '1810', '1811', '1812', '1813', '1814', '1815', '1816', '1817', '1818', '1819', '1820', '1821', '1822', '1823', '1824', '1825', '1826', '1827', '1828', '1829', '1830', '1831', '1832', '1833', '1834', '1835', '1836', '1837', '1838', '1839', '1840', '1841', '1842', '1843', '1844', '1845', '1846', '1847', '1848', '1849', '1850', '1851', '1852', '1853', '1854', '1855', '1856', '1857', '1858', '1859', '1860', '1861', '1862', '1863', '1864', '1865', '1866', '1867', '1868', '1869', '1870', '1871', '1872', '1873', '1874', '1875', '1876', '1877', '1878', '1879', '1880', '1881', '1882', '1883', '1884', '1885', '1886', '1887', '1888', '1889', '1890', '1891', '1892', '1893', '1894', '1895', '1896', '1897', '1898', '1899', '1900', '1901', '1902', '1903', '1904', '1905', '1906', '1907', '1908', '1909', '1910', '1911', '1912', '1913', '1914', '1915', '1916', '1917', '1918', '1919', '1920', '1921', '1922', '1923', '1924', '1925', '1926', '1927', '1928', '1929', '1930', '1931', '1932', '1933', '1934', '1935', '1936', '1937', '1938', '1939', '1940', '1941', '1942', '1943', '1944', '1945', '1946', '1947', '1948', '1949', '1950', '1951', '1952', '1953', '1954', '1955', '1956', '1957', '1958', '1959', '1960', '1961', '1962', '1963', '1964', '1965', '1966', '1967', '1968', '1969', '1970', '1971', '1972', '1973', '1974', '1975', '1976', '1977', '1978', '1979', '1980', '1981', '1982', '1983', '1984', '1985', '1986', '1987', '1988', '1989', '1990', '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017', '2018']
BIN_EDGES = [1.12, 1.895, 2.67, 3.445, 4.22, 4.995, 5.77, 6.545, 7.32, 8.095, 8.87]
BIN_LABELS = ['1.12-1.90', '1.90-2.67', '2.67-3.44', '3.44-4.22', '4.22-4.99', '4.99-5.77', '5.77-6.54', '6.54-7.32', '7.32-8.09', '8.09-8.87']
HISTS = {'1800': [0, 0, 0, 5, 13, 37, 70, 55, 3, 1], '1801': [0, 0, 0, 5, 12, 38, 70, 55, 3, 1], '1802': [0, 0, 0, 5, 12, 38, 70, 55, 3, 1], '1803': [0, 0, 0, 5, 13, 37, 70, 55, 3, 1], '1804': [0, 0, 0, 6, 11, 38, 70, 55, 3, 1], '1805': [0, 0, 0, 4, 13, 38, 70, 55, 3, 1], '1806': [0, 0, 0, 4, 14, 37, 70, 55, 3, 1], '1807': [0, 0, 0, 4, 14, 37, 70, 55, 3, 1], '1808': [0, 0, 0, 6, 13, 36, 70, 55, 3, 1], '1809': [0, 0, 1, 6, 12, 36, 70, 55, 3, 1], '1810': [0, 0, 0, 5, 13, 37, 70, 55, 3, 1], '1811': [0, 0, 0, 5, 12, 38, 70, 55, 3, 1], '1812': [0, 0, 0, 4, 14, 37, 70, 55, 3, 1], '1813': [0, 0, 0, 5, 13, 37, 70, 55, 3, 1], '1814': [0, 0, 0, 5, 13, 37, 70, 55, 3, 1], '1815': [0, 0, 0, 4, 14, 36, 71, 55, 3, 1], '1816': [0, 0, 0, 4, 13, 38, 69, 56, 3, 1], '1817': [0, 0, 0, 4, 15, 36, 69, 56, 3, 1], '1818': [0, 0, 0, 4, 15, 36, 69, 56, 3, 1], '1819': [0, 0, 0, 4, 15, 37, 68, 56, 3, 1], '1820': [0, 0, 0, 4, 14, 38, 68, 56, 3, 1], '1821': [0, 0, 0, 4, 11, 41, 68, 56, 3, 1], '1822': [0, 0, 0, 4, 13, 39, 69, 55, 3, 1], '1823': [0, 0, 0, 4, 12, 41, 68, 55, 3, 1], '1824': [0, 0, 0, 3, 15, 39, 68, 55, 3, 1], '1825': [0, 0, 0, 3, 14, 39, 68, 56, 3, 1], '1826': [0, 0, 0, 4, 14, 38, 69, 55, 3, 1], '1827': [0, 0, 0, 4, 14, 38, 69, 55, 3, 1], '1828': [0, 0, 0, 4, 14, 38, 69, 55, 3, 1], '1829': [0, 0, 0, 4, 16, 36, 69, 55, 3, 1], '1830': [0, 0, 0, 4, 16, 36, 69, 55, 3, 1], '1831': [0, 0, 0, 4, 17, 36, 68, 55, 3, 1], '1832': [0, 0, 0, 4, 17, 36, 68, 55, 3, 1], '1833': [0, 0, 0, 5, 15, 37, 68, 55, 3, 1], '1834': [0, 0, 0, 4, 17, 36, 68, 55, 3, 1], '1835': [0, 0, 0, 4, 17, 36, 69, 54, 3, 1], '1836': [0, 0, 0, 5, 16, 36, 69, 54, 3, 1], '1837': [0, 0, 0, 6, 15, 36, 68, 55, 3, 1], '1838': [0, 0, 0, 5, 16, 35, 70, 54, 3, 1], '1839': [0, 0, 0, 6, 15, 35, 70, 54, 3, 1], '1840': [0, 0, 0, 5, 15, 36, 69, 55, 3, 1], '1841': [0, 0, 0, 4, 17, 35, 70, 54, 3, 1], '1842': [0, 0, 0, 4, 17, 35, 70, 54, 3, 1], '1843': [0, 0, 0, 4, 17, 35, 70, 54, 3, 1], '1844': [0, 0, 0, 4, 16, 36, 70, 54, 3, 1], '1845': [0, 0, 0, 4, 17, 36, 69, 54, 3, 1], '1846': [0, 0, 0, 4, 17, 36, 69, 54, 3, 1], '1847': [0, 0, 0, 5, 16, 36, 69, 54, 3, 1], '1848': [0, 0, 0, 3, 19, 35, 69, 54, 3, 1], '1849': [0, 0, 0, 3, 19, 35, 69, 54, 3, 1], '1850': [0, 0, 0, 3, 19, 36, 68, 54, 3, 1], '1851': [0, 0, 0, 4, 17, 37, 68, 54, 3, 1], '1852': [0, 0, 1, 3, 20, 35, 67, 54, 3, 1], '1853': [0, 0, 1, 3, 20, 35, 67, 54, 3, 1], '1854': [0, 0, 1, 2, 21, 39, 63, 54, 3, 1], '1855': [0, 0, 2, 2, 22, 37, 63, 54, 3, 1], '1856': [0, 0, 1, 2, 22, 38, 63, 54, 3, 1], '1857': [0, 0, 1, 2, 23, 37, 63, 54, 3, 1], '1858': [0, 0, 0, 5, 21, 37, 63, 54, 3, 1], '1859': [0, 0, 0, 4, 23, 36, 62, 55, 3, 1], '1860': [0, 0, 1, 5, 20, 36, 63, 55, 3, 1], '1861': [0, 0, 0, 5, 19, 39, 63, 54, 3, 1], '1862': [0, 0, 1, 6, 17, 38, 63, 55, 3, 1], '1863': [0, 0, 1, 5, 19, 38, 62, 55, 3, 1], '1864': [0, 0, 1, 4, 18, 38, 65, 54, 3, 1], '1865': [0, 0, 0, 5, 20, 36, 65, 54, 3, 1], '1866': [0, 0, 0, 5, 19, 38, 64, 54, 3, 1], '1867': [0, 0, 0, 7, 18, 37, 64, 54, 3, 1], '1868': [0, 0, 1, 8, 16, 37, 65, 53, 3, 1], '1869': [0, 0, 0, 8, 18, 36, 64, 54, 3, 1], '1870': [0, 0, 1, 8, 17, 35, 65, 54, 3, 1], '1871': [0, 0, 1, 7, 19, 35, 64, 54, 3, 1], '1872': [0, 0, 0, 8, 22, 31, 65, 54, 3, 1], '1873': [0, 0, 1, 8, 19, 33, 65, 54, 3, 1], '1874': [0, 0, 0, 9, 19, 33, 65, 54, 3, 1], '1875': [0, 0, 0, 8, 20, 36, 62, 54, 3, 1], '1876': [0, 0, 0, 6, 23, 35, 61, 55, 3, 1], '1877': [0, 0, 0, 6, 23, 35, 61, 55, 3, 1], '1878': [0, 0, 2, 5, 25, 32, 61, 55, 3, 1], '1879': [0, 0, 3, 5, 22, 35, 60, 55, 3, 1], '1880': [0, 0, 3, 5, 20, 38, 59, 55, 3, 1], '1881': [0, 0, 3, 6, 20, 36, 60, 55, 3, 1], '1882': [0, 0, 3, 7, 20, 36, 59, 55, 3, 1], '1883': [0, 0, 3, 7, 20, 34, 62, 54, 3, 1], '1884': [0, 0, 2, 7, 20, 35, 61, 55, 3, 1], '1885': [0, 0, 2, 9, 21, 32, 61, 55, 3, 1], '1886': [0, 0, 2, 8, 23, 33, 60, 55, 2, 1], '1887': [0, 0, 2, 7, 22, 34, 60, 56, 2, 1], '1888': [0, 0, 2, 7, 22, 35, 59, 56, 2, 1], '1889': [0, 0, 2, 9, 23, 34, 59, 54, 2, 1], '1890': [0, 0, 2, 11, 22, 32, 60, 54, 2, 1], '1891': [0, 0, 2, 13, 18, 36, 58, 53, 3, 1], '1892': [0, 0, 2, 14, 19, 34, 58, 54, 2, 1], '1893': [0, 0, 2, 13, 20, 34, 58, 54, 2, 1], '1894': [0, 0, 2, 14, 18, 34, 58, 55, 1, 2], '1895': [0, 0, 2, 14, 19, 32, 59, 54, 2, 2], '1896': [0, 0, 2, 14, 19, 33, 59, 53, 4, 0], '1897': [0, 0, 2, 14, 20, 32, 58, 54, 4, 0], '1898': [0, 0, 2, 15, 19, 33, 58, 54, 3, 0], '1899': [0, 0, 3, 14, 21, 32, 57, 53, 4, 0], '1900': [0, 0, 3, 14, 19, 33, 58, 53, 4, 0], '1901': [0, 0, 2, 14, 18, 36, 58, 53, 3, 0], '1902': [0, 0, 3, 14, 18, 35, 58, 52, 4, 0], '1903': [0, 0, 5, 13, 16, 35, 60, 52, 3, 0], '1904': [0, 0, 4, 15, 16, 34, 60, 52, 3, 0], '1905': [0, 0, 4, 15, 20, 31, 59, 52, 3, 0], '1906': [0, 0, 5, 14, 20, 29, 61, 52, 3, 0], '1907': [0, 1, 4, 15, 17, 32, 60, 53, 2, 0], '1908': [0, 1, 5, 15, 17, 30, 61, 52, 3, 0], '1909': [0, 1, 6, 14, 18, 31, 59, 53, 2, 0], '1910': [0, 1, 7, 13, 18, 29, 61, 53, 2, 0], '1911': [0, 1, 6, 15, 15, 32, 60, 53, 2, 0], '1912': [0, 1, 7, 15, 17, 28, 61, 52, 3, 0], '1913': [0, 1, 10, 14, 17, 28, 59, 53, 2, 0], '1914': [0, 1, 11, 16, 15, 28, 58, 53, 2, 0], '1915': [1, 2, 14, 13, 14, 31, 55, 52, 2, 0], '1916': [1, 3, 13, 15, 13, 29, 56, 52, 2, 0], '1917': [1, 5, 15, 10, 13, 32, 55, 51, 2, 0], '1918': [1, 5, 16, 11, 11, 31, 56, 51, 2, 0], '1919': [1, 5, 18, 10, 13, 30, 54, 51, 2, 0], '1920': [0, 3, 15, 13, 14, 32, 53, 52, 2, 0], '1921': [0, 4, 14, 13, 15, 30, 54, 52, 2, 0], '1922': [0, 7, 13, 10, 15, 29, 56, 53, 1, 0], '1923': [0, 8, 13, 8, 16, 29, 56, 53, 1, 0], '1924': [0, 10, 13, 6, 17, 29, 54, 54, 1, 0], '1925': [0, 11, 12, 7, 18, 26, 55, 54, 1, 0], '1926': [0, 12, 10, 8, 19, 25, 56, 53, 1, 0], '1927': [0, 12, 10, 9, 19, 26, 53, 53, 2, 0], '1928': [0, 14, 9, 10, 19, 24, 55, 51, 2, 0], '1929': [0, 15, 10, 9, 20, 22, 54, 53, 1, 0], '1930': [1, 14, 8, 11, 19, 25, 52, 52, 2, 0], '1931': [3, 15, 6, 11, 20, 25, 51, 51, 2, 0], '1932': [3, 15, 9, 9, 19, 25, 50, 52, 2, 0], '1933': [6, 13, 8, 11, 19, 22, 51, 51, 3, 0], '1934': [6, 14, 8, 11, 17, 24, 52, 49, 3, 0], '1935': [7, 13, 8, 13, 15, 26, 51, 47, 4, 0], '1936': [7, 12, 10, 11, 17, 25, 50, 48, 4, 0], '1937': [7, 14, 11, 10, 14, 25, 51, 48, 4, 0], '1938': [6, 15, 12, 11, 13, 25, 50, 46, 6, 0], '1939': [4, 16, 15, 10, 12, 27, 47, 46, 7, 0], '1940': [5, 12, 19, 11, 10, 28, 45, 45, 9, 0], '1941': [6, 12, 20, 7, 13, 27, 47, 43, 9, 0], '1942': [3, 15, 22, 6, 12, 28, 46, 42, 10, 0], '1943': [3, 16, 21, 6, 12, 27, 46, 43, 10, 0], '1944': [4, 15, 22, 6, 12, 29, 43, 43, 10, 0], '1945': [4, 14, 23, 5, 14, 28, 42, 44, 10, 0], '1946': [1, 10, 27, 8, 12, 29, 43, 43, 11, 0], '1947': [1, 8, 23, 15, 10, 30, 43, 43, 11, 0], '1948': [1, 11, 23, 11, 14, 27, 41, 43, 13, 0], '1949': [1, 14, 19, 12, 12, 27, 39, 48, 12, 0], '1950': [2, 15, 16, 14, 12, 25, 39, 46, 14, 1], '1951': [0, 17, 19, 11, 11, 23, 42, 47, 14, 0], '1952': [0, 16, 22, 9, 10, 20, 43, 52, 12, 0], '1953': [0, 18, 19, 12, 9, 18, 44, 53, 11, 0], '1954': [0, 19, 17, 12, 10, 15, 47, 53, 11, 0], '1955': [0, 19, 17, 12, 11, 10, 51, 53, 11, 0], '1956': [0, 19, 16, 13, 11, 11, 45, 57, 11, 1], '1957': [0, 19, 16, 14, 7, 12, 46, 55, 14, 1], '1958': [0, 22, 15, 12, 7, 13, 45, 53, 16, 1], '1959': [0, 22, 15, 12, 8, 11, 45, 56, 14, 1], '1960': [0, 21, 16, 13, 7, 11, 44, 56, 15, 1], '1961': [0, 23, 15, 11, 8, 12, 42, 58, 14, 1], '1962': [2, 21, 17, 9, 7, 12, 44, 57, 14, 1], '1963': [2, 21, 19, 8, 8, 10, 42, 57, 16, 1], '1964': [2, 22, 19, 9, 6, 10, 44, 55, 15, 2], '1965': [2, 23, 19, 10, 5, 10, 44, 54, 15, 2], '1966': [2, 25, 17, 12, 4, 14, 41, 52, 15, 2], '1967': [1, 27, 18, 9, 6, 15, 41, 49, 16, 2], '1968': [1, 30, 15, 9, 8, 14, 41, 47, 17, 2], '1969': [0, 31, 18, 9, 6, 19, 39, 45, 15, 2], '1970': [1, 33, 15, 9, 8, 22, 36, 44, 14, 2], '1971': [2, 32, 15, 12, 8, 20, 34, 44, 15, 2], '1972': [3, 33, 15, 11, 9, 20, 33, 43, 15, 2], '1973': [6, 33, 15, 9, 13, 19, 29, 42, 16, 2], '1974': [9, 33, 13, 9, 15, 17, 31, 40, 15, 2], '1975': [11, 33, 13, 8, 17, 19, 29, 37, 15, 2], '1976': [13, 35, 11, 7, 17, 19, 29, 36, 15, 2], '1977': [14, 35, 11, 9, 16, 21, 26, 37, 13, 2], '1978': [17, 32, 12, 14, 12, 23, 25, 36, 10, 3], '1979': [18, 31, 12, 16, 12, 22, 29, 31, 10, 3], '1980': [19, 32, 12, 15, 14, 21, 28, 32, 8, 3], '1981': [19, 32, 13, 15, 17, 19, 26, 32, 8, 3], '1982': [19, 34, 11, 18, 16, 17, 29, 30, 7, 3], '1983': [21, 32, 13, 18, 16, 17, 29, 29, 6, 3], '1984': [24, 31, 13, 17, 15, 21, 29, 25, 6, 3], '1985': [25, 31, 17, 14, 16, 19, 28, 25, 6, 3], '1986': [27, 29, 19, 16, 14, 21, 27, 22, 7, 2], '1987': [28, 29, 18, 19, 13, 21, 25, 23, 7, 1], '1988': [26, 32, 19, 18, 17, 20, 23, 21, 7, 1], '1989': [29, 31, 19, 18, 18, 20, 25, 17, 6, 1], '1990': [30, 30, 20, 20, 19, 19, 25, 16, 4, 1], '1991': [33, 28, 26, 13, 19, 22, 22, 15, 5, 1], '1992': [36, 27, 25, 17, 20, 21, 20, 12, 5, 1], '1993': [37, 27, 28, 18, 19, 17, 23, 9, 6, 0], '1994': [39, 25, 31, 17, 20, 16, 22, 8, 6, 0], '1995': [43, 25, 30, 14, 22, 15, 21, 9, 5, 0], '1996': [44, 28, 30, 11, 24, 14, 19, 10, 4, 0], '1997': [47, 30, 26, 11, 26, 12, 19, 9, 4, 0], '1998': [48, 30, 30, 11, 23, 15, 14, 9, 4, 0], '1999': [49, 31, 29, 19, 14, 16, 14, 8, 4, 0], '2000': [49, 34, 27, 19, 14, 16, 14, 7, 4, 0], '2001': [49, 36, 27, 20, 11, 17, 14, 6, 4, 0], '2002': [49, 38, 27, 19, 10, 19, 12, 8, 2, 0], '2003': [52, 39, 25, 20, 9, 18, 12, 7, 2, 0], '2004': [57, 37, 23, 20, 8, 20, 10, 7, 2, 0], '2005': [57, 40, 21, 19, 9, 21, 8, 8, 1, 0], '2006': [55, 47, 18, 19, 9, 22, 6, 7, 1, 0], '2007': [55, 46, 23, 15, 10, 22, 7, 5, 1, 0], '2008': [54, 47, 23, 15, 12, 21, 7, 4, 1, 0], '2009': [53, 48, 25, 13, 15, 18, 8, 3, 1, 0], '2010': [54, 50, 23, 12, 17, 16, 8, 3, 1, 0], '2011': [56, 49, 24, 11, 18, 15, 9, 1, 1, 0], '2012': [56, 51, 23, 13, 18, 14, 7, 1, 1, 0], '2013': [56, 52, 22, 15, 18, 12, 7, 1, 1, 0], '2014': [57, 53, 21, 14, 19, 12, 7, 0, 1, 0], '2015': [58, 53, 20, 16, 21, 9, 6, 1, 0, 0], '2016': [58, 53, 22, 16, 21, 9, 4, 1, 0, 0], '2017': [59, 54, 21, 15, 22, 8, 4, 1, 0, 0], '2018': [61, 54, 19, 16, 21, 9, 3, 1, 0, 0]}  # HISTS[time] = [counts...]

X_LABEL = None
Y_LABEL = 'Fertility'
SHOW_AXIS_LABELS = True

CREATION_TIME = 2.0
PER_STEP_TIME = 0.12844036697247707

def make_chart(counts: list[int]) -> BarChart:
    y_max = 79
    chart = BarChart(
        values=counts,
        bar_names=BIN_LABELS,
        y_range=[0, y_max, max(1, y_max // 5)],
        y_length=4.0,
        x_length=8.0,
        bar_width=0.6,
    )
    if SHOW_AXIS_LABELS:
        chart.x_axis.label = Text(X_LABEL).scale(0.5)
        chart.y_axis.label = Text(Y_LABEL).scale(0.5)
        chart.x_axis.label.next_to(chart.x_axis, DOWN, buff=0.3)
        chart.y_axis.label.next_to(chart.y_axis, LEFT, buff=0.3)
        chart.add(chart.x_axis.label, chart.y_axis.label)
    return chart

class GenScene(Scene):
    def construct(self):
        if not TIMES:
            self.play(Write(Text("No data")))
            return

        t0 = TIMES[0]
        chart = make_chart(HISTS.get(t0, [0]*len(BIN_LABELS)))
        title = Text(str(t0), font_size=36, color=PURPLE_E).to_corner(UL, buff=0.6)

        self.play(FadeIn(chart), run_time=CREATION_TIME * 0.6)
        self.play(FadeIn(title), run_time=CREATION_TIME * 0.4)

        for ti in range(1, len(TIMES)):
            t = TIMES[ti]
            new_chart = make_chart(HISTS.get(t, [0]*len(BIN_LABELS)))
            new_title = Text(str(t), font_size=36, color=PURPLE_E).to_corner(UL, buff=0.6)

            # Align positions to improve Transform quality
            new_chart.move_to(chart.get_center())
            self.play(Transform(chart, new_chart), run_time=PER_STEP_TIME * 0.8)
            self.play(Transform(title, new_title), run_time=PER_STEP_TIME * 0.2)

        self.wait(0.5)
